var MyApp=angular.module("MyApp",["ui.router","leaflet-directive"]);MyApp.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/intro"),e.state("main",{url:"/",templateUrl:"templates/main/main.html",controller:"MainController",controllerAs:"main"}).state("intro",{url:"/intro",templateUrl:"templates/intro/intro.html",controller:"IntroController",controllerAs:"intro"}).state("main.login",{url:"login",templateUrl:"templates/login/login.html"}).state("main.other",{url:"other",templateUrl:"templates/other/other.html"}).state("stuff",{url:"/stuff",templateUrl:"templates/stuff/stuff.html",controller:"StuffController",controllerAs:"stuffCtrl"})}]),MyApp.service("ApiService",["$http",function(e){this.syncMethod=function(){return 0},this.getThings=function(){return console.log(window.env.API_URL+"/stop"),e.get(window.env.API_URL+"/stop").then(function(e){return e.data})["catch"](function(e){return console.error("Error ApiService getThings ",e),{}})},this.getTimetables=function(t){return e.get(window.env.API_URL+"/stop/"+t).then(function(e){return e.data})["catch"](function(e){return console.error("Error ApiService getTimetables ",e),{}})},this.getRoute=function(t,r){return e.get(window.env.API_URL+"/route/"+t.lat+"+"+t.lng+"+"+r.lat+"+"+r.lng).then(function(e){return e.data})["catch"](function(e){return console.error("Error ApiService getRoute ",e),{}})},this.getRouteByAddress=function(t,r){return console.log(window.env.API_URL+"/routes/"+t+"+"+r),e.get(window.env.API_URL+"/routes/"+t+"+"+r).then(function(e){return e.data})["catch"](function(e){return console.error("Error ApiService getRouteByAddress ",e),{}})},this.getAddress=function(t){return e.get(window.env.API_URL+"/origin/"+t.lat+","+t.lng).then(function(e){return e.data})["catch"](function(e){return console.error("Error ApiService getAddress ",e),{}})}}]),MyApp.controller("IntroController",["$scope","ApiService","$http","leafletMarkerEvents","$window",function(e,t,r,n,o){var a=function(){e.frameHeight=o.innerHeight,e.frameWidth=o.innerWidth;var t=document.getElementById("map");t.style="height:"+e.frameHeight+"px; width:"+e.frameWidth+"px;"};a(),e.userMarker,t.getThings().then(function(t){e.stops=t,e.addUserMarker(),e.addMarker()}),e.map,e.userLocation,e.initMap=function(){e.map=L.map("map",{dragging:!0,tap:!1}),e.map.locate({watch:!0,setView:!0}),e.userLocation=e.map.locate()._initialCenter,L.tileLayer("https://api.digitransit.fi/map/v1/{id}/{z}/{x}/{y}.png",{maxZoom:16,minZoom:13,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ',id:"hsl-map"}).addTo(e.map),e.map.on("locationfound",function(r){e.userLocation=r.latlng,e.addUserMarker(),t.getAddress(e.userLocation).then(function(e){document.getElementById("origin").value=e.features[0].properties.label})}),e.map.on("drag",function(t){e.addMarker()}),o.onresize=function(e){a()},e.map.on("zoomend",function(t){e.addMarker();for(var r=0;r<e.markers.length;r++)e.markers[r].setRadius(e.getRadiusByZoom())})},e.getRadiusByZoom=function(){var t,r=e.map.getZoom();switch(!0){case 17===r:t=8;break;case 16===r:t=6;break;case 15===r:t=3;break;case r<15&&r>=13:t=1}return t},e.distanceToDraw=function(){for(var t=e.map.getZoom(),r=.0015,n=1;n<=17-t||n<4;n++)r=2*r;return r},e.drawnStop=[],e.markers=[],e.addMarker=function(){for(var r=e.map.getCenter(),n=e.distanceToDraw(),o=e.getRadiusByZoom(),a=0;a<e.stops.length;a++){var i=e.stops[a],s=i.coords.split(","),p=parseFloat(s[0]),l=parseFloat(s[1]);if(Math.abs(r.lat-p)<n&&Math.abs(r.lng-l)<2*n&&e.drawnStop.indexOf(i)===-1){var u=L.circleMarker([p,l],{color:e.colorByType(i.type)}).setRadius(o);u.bindPopup(L.popup({closeOnClick:!0}).setContent("<div class=spinner> <div class=double-bounce1></div> <div class=double-bounce2></div> </div>")),u.stopId=i.code,u.on("click",function(r){e.map.setView(r.latlng);var n=this;t.getTimetables(n.stopId).then(function(t){n._popup.setContent(e.createPopupContent(t))}),t.getRoute(e.userLocation,n._latlng).then(function(t){e.addRoute(t.data.plan.itineraries)})}),u.addTo(e.map),e.markers.push(u),e.drawnStop.push(i)}}},e.addUserMarker=function(){null!=e.userMarker&&e.map.removeLayer(e.userMarker),e.userMarker=L.circleMarker(e.userLocation,{color:"black"}).setRadius(8),e.userMarker.addTo(e.map),e.map.locate({watch:!0,setView:!1})},e.addRoute=function(t){if(null!=e.geoJSONLayers)for(var r=0;r<e.geoJSONLayers.length;r++)e.map.removeLayer(e.geoJSONLayers[r]);if(null!=e.routeTransferPopups)for(var r=0;r<e.routeTransferPopups.length;r++)e.map.removeLayer(e.routeTransferPopups[r]);e.routeTransferPopups=[],e.geoJSONLayers=[];for(var r=0;r<t.length;r++)for(var n=0;n<t[r].legs.length;n++){for(var o=[],a=0;a<t[r].legs[n].legGeometry.points.length;a++){var i=t[r].legs[n].legGeometry.points[a].split(",");o.push([i[1],i[0]])}var s=[{type:"LineString",coordinates:o}],p={color:e.routeColorByType(t[r].legs[n].mode),weight:5,opacity:.65},l=L.geoJson(s,{style:p}),u=!1;0===n&&t[r].legs[n].length>1&&(u=!0);var d={keepInView:!1,autoPan:u,closeOnClick:!1},c=L.popup(d).setLatLng([t[r].legs[n].from.lat,t[r].legs[n].from.lon]).setContent(e.popupDepartureContent(t[r].legs[n]));e.routeTransferPopups.push(c),e.geoJSONLayers.push(l)}for(var r=0;r<e.geoJSONLayers.length;r++)e.geoJSONLayers[r].addTo(e.map);for(var r=0;r<e.routeTransferPopups.length;r++)e.routeTransferPopups[r].addTo(e.map)},e.popupDepartureContent=function(t){if(null==t.startTime)return"<b style=margin:0px;padding:0px>"+Math.round(t.distance)+"m</b>";var r=new Date(t.startTime),n=r.getMinutes(),o=r.getHours();if(n<10)var n="0"+n;if(o<10)var o="0"+o;var a="<b style=margin:0px;padding:0px>"+o+":"+n+" </b>",i=e.routeColorByType(t.mode);return"WALK"===t.mode?a=a+"<b style=margin:0px;padding:0px;color:"+i+">walk </b>":null!=t.route.shortName?(a=a+"<b style=margin:0px;padding:0px;color:"+i+">"+t.route.shortName+"</b>",a=a+"<b style=margin:0px;padding:0px;> "+t.trip.tripHeadsign+"</b>"):"SUBWAY"===t.mode&&(a=a+"<b style=margin:0px;padding:0px;color:"+i+">M</b>",a=a+"<b style=margin:0px;padding:0px;> "+t.trip.tripHeadsign+"</b>"),a},e.routeColorByType=function(e){return"WALK"===e?"#00cc99":"BUS"===e?"#0066cc":"TRAM"===e?"#00cc00":"SUBWAY"===e?"DarkOrange":"RAIL"===e?"#cc00cc":"FERRY"===e?"Coral":"Grey"},e.colorByType=function(e){return"0"===e?"Green":"3"===e?"Blue":"1"===e?"Orange":"109"===e?"Purple":void 0},e.createPopupContent=function(t){if(null==t[0].departures)return"<b style=margin:0px;padding:0px>No departures to 2 hours </b>";for(var r="<b style=margin:0px;padding:0px>"+t[0].name_fi+"</b><p style=color:grey;margin:0px;padding:0px>"+t[0].address_fi+"<a style=margin:0px;padding:0px target=_blank href="+t[0].timetable_link+"> "+t[0].code_short+"</a></p>",n=0;n<t[0].departures.length;n++){var o=""+t[0].departures[n].time;if(r=r+"<b style=margin:0px;padding:0px>"+o.substr(0,2)+":"+o.substr(2,3)+"</b> "+e.parseBusNumber(t[0].departures[n].code,t[0].lines)+"<br>",n>4)break}return r},e.parseBusNumber=function(e,t){for(var r,n=0;n<t.length;n++)t[n].search(e)!==-1&&(r=t[n].split(":")[1]);return e=e.split(" ")[0],e.indexOf("M")!==-1?"<b style=margin:0px;padding:0px;color:orange> M </b> <span style=margin:0px;padding:0px>"+r+"</span>":"100"===e.substr(0,3)?"<b style=margin:0px;padding:0px;color:green> "+e.substr(3,e.toString().length)+"</b> <span style=margin:0px;padding:0px>"+r+"</span>":"1010"===e?"<b style=margin:0px;padding:0px;color:green> "+e.substr(2,e.toString().length)+"</b> <span style=margin:0px;padding:0px>"+r+"</span>":"10"===e.substr(0,2)?"<b style=margin:0px;padding:0px;color:blue;font-size:15px> "+e.substr(2,e.toString().length)+"</b> <span style=margin:0px;padding:0px>"+r+"</span>":"300"===e.substr(0,3)?"<b style=margin:0px;padding:0px;color:purple> "+e.substr(4,e.toString().length)+"</b> <span style=margin:0px;padding:0px>"+r+"</span>":"<b style=margin:0px;padding:0px;color:blue> "+e.substr(1,e.toString().length)+"</b> <span style=margin:0px;padding:0px>"+r+"</span>"},e.searchButtonEvent=function(){var r=document.getElementById("origin").value.replace("ä","a").replace("ö","o"),n=document.getElementById("destination").value.replace("ä","a").replace("ö","o");t.getRouteByAddress(r,n).then(function(t){e.addRoute(t.data.plan.itineraries)})},e.initMap(),document.documentElement.style.overflow="hidden"}]),MyApp.controller("LoginController",function(){}),MyApp.controller("MainController",["$scope",function(e){e.doStuff=function(){return"stuff"}}]),MyApp.controller("StuffController",function(){});
//# sourceMappingURL=app.min.js.map
