{"version":3,"sources":["app.min.js"],"names":["MyApp","angular","module","config","$stateProvider","$urlRouterProvider","otherwise","state","url","templateUrl","controller","controllerAs","service","$http","this","syncMethod","getThings","get","window","env","API_URL","then","response","data","err","console","error","getTimetables","id","getRoute","origin","destination","lat","lng","getRouteByAddress","log","getAddress","coordinates","$scope","ApiService","PanelService","MarkerService","leafletMarkerEvents","$window","resizeMap","frameHeight","innerHeight","frameWidth","innerWidth","map","document","getElementById","style","userMarker","stops","addMarker","userLocation","initMap","L","dragging","tap","locate","watch","setView","_initialCenter","tileLayer","maxZoom","minZoom","attribution","addTo","on","e","latlng","addUserMarker","address","value","features","properties","label","onresize","event","i","markers","length","setRadius","markerRadiusByZoom","getZoom","drawnStop","center","getCenter","dis","distanceToDrawMarkersByZoom","radius","stop","coords","split","parseFloat","Math","abs","indexOf","marker","circleMarker","color","colorByType","type","bindPopup","popup","closeOnClick","setContent","stopId","code","thisMarker","_popup","createPopupContent","_latlng","route","addRoute","plan","itineraries","push","removeLayer","createUserMarker","geoJSONLayers","routeTransferPopups","routeInformation","j","legs","h","legGeometry","points","myLines","myStyle","routeColorByType","mode","weight","opacity","geoJSONLayer","geoJson","autoPan","popupOptions","keepInView","transferPopup","setLatLng","from","lon","popupDepartureContent","innerHTML","getPanelElements","newSliderHeight","leg","startTime","round","distance","time","Date","minutes","getMinutes","hours","getHours","content","shortName","trip","tripHeadsign","departures","name_fi","address_fi","timetable_link","code_short","substr","parseBusNumber","lines","busCode","search","toString","searchButtonEvent","replace","json","$","is","slideToggle","jQuery","documentElement","overflow","doStuff","currentZoom","newRadius","location","endTime","endMinutes","endHours","to","name"],"mappings":"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","file":"app.min.js","sourcesContent":["var MyApp = angular.module(\"MyApp\", [\"ui.router\", \"leaflet-directive\"]);\n\nMyApp.config([\"$stateProvider\", \"$urlRouterProvider\", function($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/intro\");\n  \n  $stateProvider\n    .state(\"main\", {\n      url: \"/\",\n      templateUrl: \"templates/main/main.html\",\n      controller: \"MainController\",\n      controllerAs: \"main\"\n    })\n    .state(\"intro\", {\n      url: \"/intro\",\n      templateUrl: \"templates/intro/intro.html\",\n      controller: \"IntroController\",\n      controllerAs: \"intro\"\n    })\n    .state(\"main.login\", {\n      url: \"login\",\n      templateUrl: \"templates/login/login.html\",\n    })\n    .state(\"main.other\", {\n      url: \"other\",\n      templateUrl: \"templates/other/other.html\",\n    })\n    .state(\"stuff\", {\n      url: \"/stuff\",\n      templateUrl: \"templates/stuff/stuff.html\",\n      controller: \"StuffController\",\n      controllerAs: \"stuffCtrl\"\n    })\n}]);\n\nMyApp.service(\"ApiService\", [\"$http\", function($http) {\n    this.syncMethod = function() {\n        return 0;\n    }\n\n    this.getThings = function() {\n        return $http.get(window.env.API_URL + \"/stop\")\n            .then(function(response) {\n                return response.data;\n            })\n            .catch(function(err) {\n                console.error(\"Error ApiService getThings \", err);\n                return {};\n            })\n    }\n\n    this.getTimetables = function(id) {\n        return $http.get(window.env.API_URL + \"/stop/\" + id)\n            .then(function(response) {\n                return response.data;\n            })\n            .catch(function(err) {\n                console.error(\"Error ApiService getTimetables \", err);\n                return {};\n            })\n    }\n\n    this.getRoute = function(origin, destination) {\n        // console.log(\"http://localhost:3332/route/\" + origin.lat +\"+\"+ origin.lng +\"+\"+ destination.lat +\"+\"+ destination.lng)\n        return $http.get(window.env.API_URL + \"/route/\" + origin.lat + \"+\" + origin.lng + \"+\" + destination.lat + \"+\" + destination.lng)\n            .then(function(response) {\n                return response.data;\n            })\n            .catch(function(err) {\n                console.error(\"Error ApiService getRoute \", err);\n                return {};\n            })\n    }\n\n    this.getRouteByAddress = function(origin, destination) {\n        console.log(window.env.API_URL + \"/routes/\" + origin + \"+\" + destination)\n        return $http.get(window.env.API_URL + \"/routes/\" + origin + \"+\" + destination)\n            .then(function(response) {\n                return response.data;\n            })\n            .catch(function(err) {\n                console.error(\"Error ApiService getRouteByAddress \", err);\n                return {};\n            })\n    }\n\n    this.getAddress = function(coordinates) {\n        return $http.get(window.env.API_URL + \"/origin/\" + coordinates.lat + \",\" + coordinates.lng)\n            .then(function(response) {\n                return response.data;\n            })\n            .catch(function(err) {\n                console.error(\"Error ApiService getAddress \", err);\n                return {};\n            })\n    }\n\n}])\n\nMyApp.controller('IntroController', [\"$scope\", \"ApiService\", \"PanelService\", \"MarkerService\", \"$http\", \"leafletMarkerEvents\", \"$window\", function($scope, ApiService, PanelService, MarkerService, $http, leafletMarkerEvents, $window) {\n    var resizeMap = function() {\n        $scope.frameHeight = $window.innerHeight;\n        $scope.frameWidth = $window.innerWidth;\n        var map = document.getElementById(\"map\");\n        map.style = \"height:\" + $scope.frameHeight + \"px; width:\" + $scope.frameWidth + \"px;\"\n    }\n    resizeMap();\n    $scope.userMarker;\n    ApiService.getThings()\n        .then(function(stops) {\n            $scope.stops = stops;\n            $scope.addMarker();\n        })\n    $scope.map, $scope.userLocation;\n    $scope.initMap = function() {\n        $scope.map = L.map('map', {\n            dragging: true,\n            tap: false,\n        });\n        $scope.map.locate({\n            watch: true,\n            setView: true\n        });\n        $scope.userLocation = $scope.map.locate()._initialCenter;\n        L.tileLayer('https://api.digitransit.fi/map/v1/{id}/{z}/{x}/{y}.png', {\n            maxZoom: 16,\n            minZoom: 14,\n            attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, ' +\n                '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ',\n            id: 'hsl-map'\n        }).addTo($scope.map);\n\n        $scope.map.on('locationfound', function(e) {\n            $scope.userLocation = e.latlng;\n            $scope.addUserMarker();\n            ApiService.getAddress($scope.userLocation)\n                .then(function(address) {\n                    document.getElementById(\"origin\").value = address.features[0].properties.label;\n                })\n        });\n        $scope.map.on('drag', function(e) {\n            $scope.addMarker()\n        });\n        $window.onresize = function(event) {\n            resizeMap();\n        };\n        $scope.map.on('zoomend', function(e) {\n            $scope.addMarker()\n            for (var i = 0; i < $scope.markers.length; i++) {\n                $scope.markers[i].setRadius(MarkerService.markerRadiusByZoom($scope.map.getZoom()));\n            }\n        });\n    }\n    $scope.drawnStop = [], $scope.markers = [];\n    $scope.addMarker = function() {\n        var center = $scope.map.getCenter(),\n            dis = MarkerService.distanceToDrawMarkersByZoom($scope.map.getZoom()),\n            radius = MarkerService.markerRadiusByZoom($scope.map.getZoom());\n        for (var i = 0; i < $scope.stops.length; i++) {\n            var stop = $scope.stops[i];\n            var coords = stop.coords.split(\",\");\n            var lat = parseFloat(coords[0]),\n                lng = parseFloat(coords[1]);\n            if (Math.abs(center.lat - lat) < dis && Math.abs(center.lng - lng) < dis * 2 && $scope.drawnStop.indexOf(stop) === -1) {\n                var marker = L.circleMarker([lat, lng], {\n                    color: $scope.colorByType(stop.type)\n                }).setRadius(radius);\n                marker.bindPopup(L.popup({\n                    closeOnClick: true\n                }).setContent(\"<div class=\" + \"spinner\" + \"> <div class=\" + \"double-bounce1\" + \"></div> <div class=\" + \"double-bounce2\" + \"></div> </div>\"));\n                marker.stopId = stop.code;\n                marker.on('click', function(e) {\n                    $scope.map.setView(e.latlng);\n                    var thisMarker = this;\n                    ApiService.getTimetables(thisMarker.stopId)\n                        .then(function(stop) {\n                            thisMarker._popup.setContent($scope.createPopupContent(stop));\n                        })\n                    ApiService.getRoute($scope.userLocation, thisMarker._latlng)\n                        .then(function(route) {\n                            $scope.addRoute(route.data.plan.itineraries);\n                        })\n                });\n                marker.addTo($scope.map);\n                $scope.markers.push(marker);\n                $scope.drawnStop.push(stop);\n            }\n        }\n    }\n\n    $scope.addUserMarker = function() {\n        if ($scope.userMarker != null) {\n            $scope.map.removeLayer($scope.userMarker)\n        }\n        $scope.userMarker = MarkerService.createUserMarker($scope.userLocation);\n        $scope.userMarker.addTo($scope.map);\n        $scope.map.locate({\n            watch: true,\n            setView: false\n        });\n    }\n\n    $scope.addRoute = function(itineraries) {\n        if ($scope.geoJSONLayers != null) {\n            for (var i = 0; i < $scope.geoJSONLayers.length; i++) {\n                $scope.map.removeLayer($scope.geoJSONLayers[i]);\n            }\n        }\n        if ($scope.routeTransferPopups != null) {\n            for (var i = 0; i < $scope.routeTransferPopups.length; i++) {\n                $scope.map.removeLayer($scope.routeTransferPopups[i]);\n            }\n        }\n        $scope.routeTransferPopups = [];\n        $scope.geoJSONLayers = [];\n        $scope.routeInformation = [];\n        for (var i = 0; i < itineraries.length; i++) {\n            for (var j = 0; j < itineraries[i].legs.length; j++) {\n                var coordinates = [];\n                for (var h = 0; h < itineraries[i].legs[j].legGeometry.points.length; h++) {\n                    var latlng = itineraries[i].legs[j].legGeometry.points[h].split(\",\");\n                    coordinates.push([latlng[1], latlng[0]])\n                }\n                var myLines = [{\n                    \"type\": \"LineString\",\n                    \"coordinates\": coordinates,\n                }];\n                var myStyle = {\n                    \"color\": PanelService.routeColorByType(itineraries[i].legs[j].mode),\n                    \"weight\": 5,\n                    \"opacity\": 0.65\n                };\n                var geoJSONLayer = L.geoJson(myLines, {\n                    style: myStyle\n                });\n                var autoPan = false;\n                if (j === 0 && itineraries[i].legs[j].length > 1) {\n                    autoPan = true;\n                }\n                var popupOptions = {\n                    \"keepInView\": false,\n                    \"autoPan\": autoPan,\n                    \"closeOnClick\": false\n                }\n                $scope.routeInformation.push(itineraries[i].legs[j]);\n                var transferPopup = L.popup(popupOptions)\n                    .setLatLng([itineraries[i].legs[j].from.lat, itineraries[i].legs[j].from.lon])\n                    .setContent($scope.popupDepartureContent(itineraries[i].legs[j]));\n                $scope.routeTransferPopups.push(transferPopup);\n                $scope.geoJSONLayers.push(geoJSONLayer);\n            }\n        }\n        document.getElementById(\"routepanel\").innerHTML = PanelService.getPanelElements($scope.routeInformation);\n        var newSliderHeight = 30 + $scope.routeInformation.length * 20 + \"px;\";\n        document.getElementById(\"foot\").style = \"height:\" + newSliderHeight;\n        for (var i = 0; i < $scope.geoJSONLayers.length; i++) {\n            $scope.geoJSONLayers[i].addTo($scope.map);\n        }\n        for (var i = 0; i < $scope.routeTransferPopups.length; i++) {\n            $scope.routeTransferPopups[i].addTo($scope.map);\n        }\n    }\n\n    $scope.popupDepartureContent = function(leg) {\n        if (leg.startTime == null) return \"<b style=margin:0px;padding:0px>\" + Math.round(leg.distance) + \"m</b>\";\n        var time = new Date(leg.startTime);\n        var minutes = time.getMinutes(),\n            hours = time.getHours();\n        if (minutes < 10) {\n            var minutes = \"0\" + minutes;\n        }\n        if (hours < 10) {\n            var hours = \"0\" + hours;\n        }\n        var content = \"<b style=margin:0px;padding:0px>\" + hours + \":\" + minutes + \" </b>\"\n        var color = PanelService.routeColorByType(leg.mode);\n        if (leg.mode === \"WALK\") {\n            content = content + \"<b style=margin:0px;padding:0px;color:\" + color + \">walk </b>\"\n        } else if (leg.route.shortName != null) {\n            content = content + \"<b style=margin:0px;padding:0px;color:\" + color + \">\" + leg.route.shortName + \"</b>\"\n            content = content + \"<b style=margin:0px;padding:0px;> \" + leg.trip.tripHeadsign + \"</b>\"\n        } else if (leg.mode === \"SUBWAY\") {\n            content = content + \"<b style=margin:0px;padding:0px;color:\" + color + \">M</b>\"\n            content = content + \"<b style=margin:0px;padding:0px;> \" + leg.trip.tripHeadsign + \"</b>\"\n        }\n        return content;\n    }\n\n    $scope.colorByType = function(type) {\n        if (type === \"0\") {\n            return \"Green\";\n        }\n        if (type === \"3\") {\n            return \"Blue\";\n        }\n        if (type === \"1\") {\n            return \"Orange\";\n        }\n        if (type === \"109\") {\n            return \"Purple\";\n        }\n    }\n    $scope.createPopupContent = function(data) {\n        if (data[0].departures == null) return \"<b style=margin:0px;padding:0px>No departures to 2 hours </b>\"\n        var content = \"<b style=margin:0px;padding:0px>\" + data[0].name_fi + \"</b><p style=color:grey;margin:0px;padding:0px>\" + data[0].address_fi + \"<a style=margin:0px;padding:0px target=_blank href=\" + data[0].timetable_link + \">\" + \" \" + data[0].code_short + \"</a></p>\";\n        for (var i = 0; i < data[0].departures.length; i++) {\n            var time = \"\" + data[0].departures[i].time;\n            content = content + \"<b style=margin:0px;padding:0px>\" + time.substr(0, 2) + \":\" + time.substr(2, 3) + \"</b>\" + \" \" + $scope.parseBusNumber(data[0].departures[i].code, data[0].lines) + \"<br>\"\n            if (i > 4) {\n                break;\n            }\n        }\n        return content;\n    }\n    $scope.parseBusNumber = function(busCode, lines) {\n        var destination;\n        for (var i = 0; i < lines.length; i++) {\n            if (lines[i].search(busCode) !== -1) {\n                destination = lines[i].split(\":\")[1];\n            }\n        }\n        busCode = busCode.split(\" \")[0];\n        if (busCode.indexOf(\"M\") !== -1) {\n            return \"<b style=margin:0px;padding:0px;color:orange> M </b> <span style=margin:0px;padding:0px>\" + destination + \"</span>\";\n        }\n        if (busCode.substr(0, 3) === \"100\") {\n            return \"<b style=margin:0px;padding:0px;color:green> \" + busCode.substr(3, busCode.toString().length) + \"</b> <span style=margin:0px;padding:0px>\" + destination + \"</span>\";\n        }\n        if (busCode === \"1010\") {\n            return \"<b style=margin:0px;padding:0px;color:green> \" + busCode.substr(2, busCode.toString().length) + \"</b> <span style=margin:0px;padding:0px>\" + destination + \"</span>\";\n        }\n        if (busCode.substr(0, 2) === \"10\") {\n            return \"<b style=margin:0px;padding:0px;color:blue;font-size:15px> \" + busCode.substr(2, busCode.toString().length) + \"</b> <span style=margin:0px;padding:0px>\" + destination + \"</span>\";\n        }\n        if (busCode.substr(0, 3) === \"300\") {\n            return \"<b style=margin:0px;padding:0px;color:purple> \" + busCode.substr(4, busCode.toString().length) + \"</b> <span style=margin:0px;padding:0px>\" + destination + \"</span>\";\n        }\n\n        return \"<b style=margin:0px;padding:0px;color:blue> \" + busCode.substr(1, busCode.toString().length) + \"</b> <span style=margin:0px;padding:0px>\" + destination + \"</span>\";\n    }\n    $scope.searchButtonEvent = function() {\n        var origin = document.getElementById(\"origin\").value.replace(\"ä\", \"a\").replace(\"ö\", \"o\"),\n            destination = document.getElementById(\"destination\").value.replace(\"ä\", \"a\").replace(\"ö\", \"o\");\n\n        ApiService.getRouteByAddress(origin, destination)\n            .then(function(json) {\n                $scope.addRoute(json.data.plan.itineraries)\n                if (!$('footer').is(':visible')) {\n                    $('footer').slideToggle(200);\n                }\n            })\n    }\n\n    jQuery(function($) {\n        $('.footer').on('click', function() {\n            $('footer').slideToggle(200);\n        });\n\n    });\n    $scope.initMap();\n    document.documentElement.style.overflow = 'hidden'; // firefox, chrome\n    // document.body.scroll = \"no\"; // ie only\n}]);\n\nMyApp.controller(\"LoginController\", function() {\n\n})\n\nMyApp.controller(\"MainController\", [\"$scope\", function($scope) {\n  $scope.doStuff = function() {\n    return \"stuff\";\n  }\n}])\n\nMyApp.service(\"MarkerService\", [\"$http\", function($http) {\n    this.markerRadiusByZoom = function(currentZoom) {\n        var newRadius;\n        switch (true) {\n            case (currentZoom === 17):\n                newRadius = 8;\n                break;\n            case (currentZoom === 16):\n                newRadius = 6;\n                break;\n            case (currentZoom === 15):\n                newRadius = 3;\n                break;\n            case (currentZoom < 15 && currentZoom >= 13):\n                newRadius = 1;\n                break;\n        }\n        return newRadius;\n    }\n\n    this.distanceToDrawMarkersByZoom = function(currentZoom) {\n        if (currentZoom === 16) return 0.004;\n        if (currentZoom === 15) return 0.005;\n        if (currentZoom === 14) return 0.009;\n    }\n    this.createUserMarker = function(location) {\n        var userMarker = L.circleMarker(location, {\n            color: \"black\"\n        }).setRadius(8);\n        return userMarker;\n    }\n}])\n\nMyApp.service(\"PanelService\", [\"$http\", function($http) {\n    this.getPanelElements = function(legs) {\n        var content = \"\";\n        if (legs[0].startTime == null) return \"\";\n        for (var i = 0; i < legs.length; i++) {\n            var leg = legs[i];\n            var time = new Date(leg.startTime);\n            var endTime = new Date(leg.endTime);\n            var minutes = time.getMinutes(),\n                hours = time.getHours();\n            var endMinutes = endTime.getMinutes(),\n                endHours = endTime.getHours();\n            if (minutes < 10) var minutes = \"0\" + minutes;\n            if (hours < 10) var hours = \"0\" + hours;\n            if (endMinutes < 10) var endMinutes = \"0\" + endMinutes;\n            if (endHours < 10) var endHours = \"0\" + endHours;\n\n            content = content + \"<b style=margin:0px;padding:0px>\" + hours + \":\" + minutes + \" </b>\"\n            var color = this.routeColorByType(leg.mode);\n            if (leg.mode === \"WALK\") {\n                content = content + \"<b style=margin:0px;padding:0px;color:\" + color + \">walk </b>\"\n                content = content + \"<b style=margin:0px;padding:0px;> to \" + leg.to.name + \"</b>\"\n            } else if (leg.route.shortName != null) {\n                content = content + \"<b style=margin:0px;padding:0px;color:\" + color + \">\" + leg.route.shortName + \"</b>\"\n                content = content + \"<b style=margin:0px;padding:0px;> (\" + leg.trip.tripHeadsign + \")</b>\"\n                content = content + \"<b style=margin:0px;padding:0px;> to \" + leg.to.name + \"</b>\"\n            } else if (leg.mode === \"SUBWAY\") {\n                content = content + \"<b style=margin:0px;padding:0px;color:\" + color + \">M</b>\"\n                content = content + \"<b style=margin:0px;padding:0px;> \" + leg.trip.tripHeadsign + \"</b>\"\n            }\n            content = content + \"<b id=endTime> \" + endHours + \":\" + endMinutes + \"</b><br>\"\n        }\n        console.log(content)\n        return content;\n    }\n\n    this.routeColorByType = function(type) {\n        if (type === \"WALK\") {\n            return \"#00cc99\";\n        }\n        if (type === \"BUS\") {\n            return \"#0066cc\";\n        }\n        if (type === \"TRAM\") {\n            return \"#00cc00\";\n        }\n        if (type === \"SUBWAY\") {\n            return \"DarkOrange\";\n        }\n        if (type === \"RAIL\") {\n            return \"#cc00cc\";\n        }\n        if (type === \"FERRY\") {\n            return \"Coral\";\n        }\n        return \"Grey\";\n    }\n}])\n\nMyApp.controller(\"StuffController\", function() {\n\n})\n"],"sourceRoot":"/source/"}